!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).LosslessJSON={})}(this,(function(n){"use strict";function t(n){return e.test(n)}var e=/^-?[0-9]+$/;function r(n){return i.test(n)}var o,i=/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/;function u(n,e){var r=parseFloat(n),o=String(r),i=f(n),u=f(o);if(i===u)return!0;if(!0===(null==e?void 0:e.approx)){if(!t(n)&&u.length>=14&&i.startsWith(u.substring(0,14)))return!0}return!1}function a(e){if(!u(e,{approx:!1})){if(t(e))return n.UnsafeNumberReason.truncate_integer;var r=parseFloat(e);return isFinite(r)?0===r?n.UnsafeNumberReason.underflow:n.UnsafeNumberReason.truncate_float:n.UnsafeNumberReason.overflow}}function f(n){return n.replace(c,"").replace(s,"").replace(y,"").replace(l,"")}n.UnsafeNumberReason=void 0,(o=n.UnsafeNumberReason||(n.UnsafeNumberReason={})).underflow="underflow",o.overflow="overflow",o.truncate_integer="truncate_integer",o.truncate_float="truncate_float";var c=/[eE][+-]?\d+$/,l=/^-?(0*)?/,s=/\./,y=/0+$/;function p(n){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},p(n)}function v(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}var d=function(){function e(n){if(function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(n,t,e){t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}(this,"isLosslessNumber",!0),!r(n))throw new Error('Invalid number (value: "'+n+'")');this.value=n}var o,i,u;return o=e,(i=[{key:"valueOf",value:function(){var e=a(this.value);if(void 0===e||e===n.UnsafeNumberReason.truncate_float)return parseFloat(this.value);if(t(this.value))return BigInt(this.value);throw new Error("Cannot safely convert to number: "+"the value '".concat(this.value,"' would ").concat(e," and become ").concat(parseFloat(this.value)))}},{key:"toString",value:function(){return this.value}}])&&v(o.prototype,i),u&&v(o,u),Object.defineProperty(o,"prototype",{writable:!1}),e}();function b(n){return n&&"object"===p(n)&&!0===n.isLosslessNumber||!1}function m(n){return new d(n)}function h(n){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},h(n)}function w(n,t){return g({"":n},"",n,t)}function g(n,t,e,r){return Array.isArray(e)?r.call(n,t,function(n,t){for(var e=0;e<n.length;e++)n[e]=g(n,e+"",n[e],t);return n}(e,r)):e&&"object"===h(e)&&!b(e)?r.call(n,t,function(n,t){return Object.keys(n).forEach((function(e){var r=g(n,e,n[e],t);void 0!==r?n[e]=r:delete n[e]})),n}(e,r)):r.call(n,t,e)}function S(n){return!0===I[n]}function N(n){return/^[0-9a-fA-F]/.test(n)}function x(n){return/[0-9]/.test(n)}function E(n){return/[1-9]/.test(n)}var O={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},I={" ":!0,"\n":!0,"\t":!0,"\r":!0};function j(n){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},j(n)}var A=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;n.LosslessNumber=d,n.config=function(n){throw new Error("config is deprecated, support for circularRefs is removed from the library. If you encounter circular references in your data structures, please rethink your datastructures: better prevent circular references in the first place.")},n.getUnsafeNumberReason=a,n.isInteger=t,n.isLosslessNumber=b,n.isNumber=r,n.isSafeNumber=u,n.parse=function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m,r=0,o=a();return v(o),b(),t?w(o,t):o;function i(){if("{"===n[r]){r++,c();for(var t={},e=!0;r<n.length&&"}"!==n[r];){e?e=!1:(y(),c());var o=l();void 0===o&&I(),void 0!==t[o]&&j(o),c(),p(),t[o]=a()}return"}"!==n[r]&&A(),r++,t}}function u(){if("["===n[r]){r++,c();for(var t=[],e=!0;r<n.length&&"]"!==n[r];){e?e=!1:y();var o=a();d(o),t.push(o)}return"]"!==n[r]&&R(),r++,t}}function a(){var n,t,e,r,o,a;c();var y=null!==(n=null!==(t=null!==(e=null!==(r=null!==(o=null!==(a=l())&&void 0!==a?a:s())&&void 0!==o?o:i())&&void 0!==r?r:u())&&void 0!==e?e:f("true",!0))&&void 0!==t?t:f("false",!1))&&void 0!==n?n:f("null",null);return c(),y}function f(t,e){if(n.slice(r,r+t.length)===t)return r+=t.length,e}function c(){for(;S(n[r]);)r++}function l(){if('"'===n[r]){r++;for(var t="";r<n.length&&'"'!==n[r];){if("\\"===n[r]){var e=n[r+1],o=O[e];void 0!==o?(t+=o,r++):"u"===e?N(n[r+2])&&N(n[r+3])&&N(n[r+4])&&N(n[r+5])?(t+=String.fromCharCode(parseInt(n.slice(r+2,r+6),16)),r+=5):k(r):_(r)}else t+=n[r];r++}return g(),r++,t}}function s(){var t=r;if("-"===n[r]&&(r++,h(t)),"0"===n[r])r++;else if(E(n[r]))for(r++;x(n[r]);)r++;if("."===n[r])for(r++,h(t);x(n[r]);)r++;if("e"===n[r]||"E"===n[r])for(r++,"-"!==n[r]&&"+"!==n[r]||r++,h(t);x(n[r]);)r++;if(r>t)return e(n.slice(t,r))}function y(){if(","!==n[r])throw new SyntaxError("Comma ',' expected after value ".concat(J()));r++}function p(){if(":"!==n[r])throw new SyntaxError("Colon ':' expected after property name ".concat(J()));r++}function v(n){if(void 0===n)throw new SyntaxError("JSON value expected ".concat(J()))}function d(n){if(void 0===n)throw new SyntaxError("Array item expected ".concat(J()))}function b(){if(r<n.length)throw new SyntaxError("Expected end of input ".concat(J()))}function h(t){if(!x(n[r])){var e=n.slice(t,r);throw new SyntaxError("Invalid number '".concat(e,"', expecting a digit ").concat(J()))}}function g(){if('"'!==n[r])throw new SyntaxError("End of string '\"' expected ".concat(J()))}function I(){throw new SyntaxError("Quoted object key expected ".concat(J()))}function j(n){throw new SyntaxError("Duplicate key '".concat(n,"' encountered at position ").concat(r-n.length-1))}function A(){throw new SyntaxError("Quoted object key or end of object '}' expected ".concat(J()))}function R(){throw new SyntaxError("Array item or end of array ']' expected ".concat(J()))}function _(t){var e=n.slice(t,t+2);throw new SyntaxError("Invalid escape character '".concat(e,"' ").concat(U()))}function k(t){for(var e=t+2;/\w/.test(n[e]);)e++;var r=n.slice(t,e);throw new SyntaxError("Invalid unicode character '".concat(r,"' ").concat(U()))}function U(){return"at position ".concat(r)}function F(){return n[r]?"but got '".concat(n[r],"'"):"but reached end of input"}function J(){return F()+" "+U()}},n.parseLosslessNumber=m,n.parseNumberAndBigInt=function(n){return t(n)?BigInt(n):parseFloat(n)},n.reviveDate=function(n,t){return"string"==typeof t&&A.test(t)?new Date(t):t},n.stringify=function n(t,e,o,i){var u=function(n){if("number"==typeof n)return" ".repeat(n);if("string"==typeof n&&""!==n)return n;return}(o);return a("function"==typeof e?e.call({"":t},"",t):t,"");function a(t,f){if(Array.isArray(i)){var c=i.find((function(n){return n.test(t)}));if(c){var l=c.stringify(t);if("string"!=typeof l||!r(l))throw new Error("Invalid JSON number: output of a number stringifier must be a string containing a JSON number "+"(output: ".concat(l,")"));return l}}return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null===t||t instanceof Date||t instanceof Boolean||t instanceof Number||t instanceof String?JSON.stringify(t):t&&t.isLosslessNumber||"bigint"==typeof t?t.toString():Array.isArray(t)?function(n,t){for(var r=u?t+u:void 0,o=u?"[\n":"[",i=0;i<n.length;i++){var f="function"==typeof e?e.call(n,String(i),n[i]):n[i];u&&(o+=r),o+=void 0!==f&&"function"!=typeof f?a(f,r):"null",i<n.length-1&&(o+=u?",\n":",")}return o+=u?"\n"+t+"]":"]"}(t,f):t&&"object"===j(t)?function(t,r){if("function"==typeof t.toJSON)return n(t.toJSON(),e,o,void 0);var i=Array.isArray(e)?e.map(String):Object.keys(t),f=u?r+u:void 0,c=!0,l=u?"{\n":"{";return i.forEach((function(n){var r="function"==typeof e?e.call(t,n,t[n]):t[n];if(function(n,t){return void 0!==t&&"function"!=typeof t&&"symbol"!==j(t)}(0,r)){c?c=!1:l+=u?",\n":",";var o=JSON.stringify(n);l+=u?f+o+": ":o+":",l+=a(r,f)}})),l+=u?"\n"+r+"}":"}"}(t,f):void 0}},n.toLosslessNumber=function(n){if(f(n+"").length>15)throw new Error("Invalid number: contains more than 15 digits and is most likely truncated and unsafe by itself "+"(value: ".concat(n,")"));if(isNaN(n))throw new Error("Invalid number: NaN");if(!isFinite(n))throw new Error("Invalid number: "+n);return new d(String(n))},n.toSafeNumberOrThrow=function(t,e){var r=parseFloat(t),o=a(t);if(!0===(null==e?void 0:e.approx)?o&&o!==n.UnsafeNumberReason.truncate_float:o){var i=o.replace(/_\w+$/,"");throw new Error("Cannot safely convert to number: "+"the value '".concat(t,"' would ").concat(i," and become ").concat(r))}return r},Object.defineProperty(n,"__esModule",{value:!0})}));//# sourceMappingURL=lossless-json.js.map
