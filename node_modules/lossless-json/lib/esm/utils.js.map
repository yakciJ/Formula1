{"version":3,"file":"utils.js","names":["isInteger","value","INTEGER_REGEX","test","isNumber","NUMBER_REGEX","isSafeNumber","config","num","parseFloat","str","String","v","extractSignificantDigits","s","approx","requiredDigits","length","startsWith","substring","UnsafeNumberReason","getUnsafeNumberReason","undefined","truncate_integer","isFinite","overflow","underflow","truncate_float","toSafeNumberOrThrow","number","unsafeReason","unsafeReasonText","replace","Error","EXPONENTIAL_PART_REGEX","DOT_REGEX","TRAILING_ZEROS_REGEX","LEADING_MINUS_AND_ZEROS_REGEX"],"sources":["../../src/utils.ts"],"sourcesContent":["/**\n * Test whether a string contains an integer number\n */\nexport function isInteger(value: string): boolean {\n  return INTEGER_REGEX.test(value)\n}\n\nconst INTEGER_REGEX = /^-?[0-9]+$/\n\n/**\n * Test whether a string contains a number\n * http://stackoverflow.com/questions/13340717/json-numbers-regular-expression\n */\nexport function isNumber(value: string): boolean {\n  return NUMBER_REGEX.test(value)\n}\n\nconst NUMBER_REGEX = /^-?(?:0|[1-9]\\d*)(?:\\.\\d+)?(?:[eE][+-]?\\d+)?$/\n\n/**\n * Test whether a string can be safely represented with a number\n * without information.\n *\n * When approx is true, floating point numbers that lose a few digits but\n * are still approximately equal in value are considered safe too.\n * Integer numbers must still be exactly equal.\n */\nexport function isSafeNumber(\n  value: string,\n  config?: {\n    approx: boolean\n  }\n): boolean {\n  const num = parseFloat(value)\n  const str = String(num)\n\n  const v = extractSignificantDigits(value)\n  const s = extractSignificantDigits(str)\n\n  if (v === s) {\n    return true\n  }\n\n  if (config?.approx === true) {\n    // A value is approximately equal when:\n    // 1. it is a floating point number, not an integer\n    // 2. it has at least 14 digits\n    // 3. the first 14 digits are equal\n    const requiredDigits = 14\n    if (\n      !isInteger(value) &&\n      s.length >= requiredDigits &&\n      v.startsWith(s.substring(0, requiredDigits))\n    ) {\n      return true\n    }\n  }\n\n  return false\n}\n\nexport enum UnsafeNumberReason {\n  underflow = 'underflow',\n  overflow = 'overflow',\n  truncate_integer = 'truncate_integer',\n  truncate_float = 'truncate_float'\n}\n\n/**\n * When the provided value is an unsafe number, describe what the reason is:\n * overflow, underflow, truncate_integer, or truncate_float.\n * Returns undefined when the value is safe.\n */\nexport function getUnsafeNumberReason(value: string): UnsafeNumberReason | undefined {\n  if (isSafeNumber(value, { approx: false })) {\n    return undefined\n  }\n\n  if (isInteger(value)) {\n    return UnsafeNumberReason.truncate_integer\n  }\n\n  const num = parseFloat(value)\n  if (!isFinite(num)) {\n    return UnsafeNumberReason.overflow\n  }\n\n  if (num === 0) {\n    return UnsafeNumberReason.underflow\n  }\n\n  return UnsafeNumberReason.truncate_float\n}\n\n/**\n * Convert a string into a number when it is safe to do so.\n * Throws an error otherwise, explaining the reason.\n */\nexport function toSafeNumberOrThrow(\n  value: string,\n  config?: {\n    approx: boolean\n  }\n): number {\n  const number = parseFloat(value)\n\n  const unsafeReason = getUnsafeNumberReason(value)\n  if (\n    config?.approx === true\n      ? unsafeReason && unsafeReason !== UnsafeNumberReason.truncate_float\n      : unsafeReason\n  ) {\n    const unsafeReasonText = unsafeReason.replace(/_\\w+$/, '')\n    throw new Error(\n      'Cannot safely convert to number: ' +\n        `the value '${value}' would ${unsafeReasonText} and become ${number}`\n    )\n  }\n\n  return number\n}\n\n/**\n * Get the significant digits of a number.\n *\n * For example:\n *   '2.34' returns '234'\n *   '-77' returns '77'\n *   '0.003400' returns '34'\n *   '120.5e+30' returns '1205'\n **/\nexport function extractSignificantDigits(value: string): string {\n  return (\n    value\n      // from \"-0.250e+30\" to \"-0.250\"\n      .replace(EXPONENTIAL_PART_REGEX, '')\n\n      // from \"-0.250\" to \"-0250\"\n      .replace(DOT_REGEX, '')\n\n      // from \"-0250\" to \"-025\"\n      .replace(TRAILING_ZEROS_REGEX, '')\n\n      // from \"-025\" to \"25\"\n      .replace(LEADING_MINUS_AND_ZEROS_REGEX, '')\n  )\n}\n\nconst EXPONENTIAL_PART_REGEX = /[eE][+-]?\\d+$/\nconst LEADING_MINUS_AND_ZEROS_REGEX = /^-?(0*)?/\nconst DOT_REGEX = /\\./\nconst TRAILING_ZEROS_REGEX = /0+$/\n"],"mappings":"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"}